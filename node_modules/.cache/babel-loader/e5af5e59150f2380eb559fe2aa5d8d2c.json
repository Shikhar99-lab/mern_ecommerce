{"ast":null,"code":"import _objectSpread from\"/Users/shikhar99/Desktop/MERN/projfrontend/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/shikhar99/Desktop/MERN/projfrontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import{loadCart,cartEmpty}from\"./helper/cartHelper\";import{Link}from\"react-router-dom\";import{getmeToken,processPayment}from\"./helper/paymentbhelper\";import{createOrder}from\"./helper/orderHelper\";import{isAutheticated}from\"../auth/helper\";import DropIn from\"braintree-web-drop-in-react\";var Paymentb=function Paymentb(_ref){var products=_ref.products,_ref$setReload=_ref.setReload,setReload=_ref$setReload===void 0?function(f){return f;}:_ref$setReload,_ref$reload=_ref.reload,reload=_ref$reload===void 0?undefined:_ref$reload;var _useState=useState({loading:false,success:false,clientToken:null,error:\"\",instance:{}}),_useState2=_slicedToArray(_useState,2),info=_useState2[0],setInfo=_useState2[1];var userId=isAutheticated()&&isAutheticated().user._id;var token=isAutheticated()&&isAutheticated().token;var getToken=function getToken(userId,token){getmeToken(userId,token).then(function(info){// console.log(\"INFORMATION\", info);\nif(info===null||info===void 0?void 0:info.error){setInfo(_objectSpread({},info,{error:info.error}));}else{var clientToken=info===null||info===void 0?void 0:info.clientToken;setInfo({clientToken:clientToken});}});};var showbtdropIn=function showbtdropIn(){return React.createElement(\"div\",null,info.clientToken!==null&&products.length>0?React.createElement(\"div\",null,React.createElement(DropIn,{options:{authorization:info.clientToken},onInstance:function onInstance(instance){return info.instance=instance;}}),React.createElement(\"button\",{className:\"btn btn-block btn-success\",onClick:onPurchase},\"Buy\")):React.createElement(\"h3\",null,\"Please login or add something to cart\"));};useEffect(function(){getToken(userId,token);},[]);var onPurchase=function onPurchase(){var _info$instance;setInfo({loading:true});var nonce;var getNonce=info===null||info===void 0?void 0:(_info$instance=info.instance)===null||_info$instance===void 0?void 0:_info$instance.requestPaymentMethod().then(function(data){nonce=data.nonce;var paymentData={paymentMethodNonce:nonce,amount:getAmount()};processPayment(userId,token,paymentData).then(function(response){setInfo(_objectSpread({},info,{success:response.success,loading:false}));console.log(\"PAYMENT SUCCESS\");var orderData={products:products,transaction_id:response.transaction.id,amount:response.transaction.amount};createOrder(userId,token,orderData);cartEmpty(function(){console.log(\"Did we got a crash?\");});setReload(!reload);}).catch(function(error){setInfo({loading:false,success:false});console.log(\"PAYMENT FAILED\");});});};var getAmount=function getAmount(){var amount=0;products.map(function(p){amount=amount+p.price;});return amount;};return React.createElement(\"div\",null,React.createElement(\"h3\",null,\"Your bill is \",getAmount(),\" $\"),showbtdropIn());};export default Paymentb;","map":{"version":3,"sources":["/Users/shikhar99/Desktop/MERN/projfrontend/src/core/Paymentb.js"],"names":["React","useState","useEffect","loadCart","cartEmpty","Link","getmeToken","processPayment","createOrder","isAutheticated","DropIn","Paymentb","products","setReload","f","reload","undefined","loading","success","clientToken","error","instance","info","setInfo","userId","user","_id","token","getToken","then","showbtdropIn","length","authorization","onPurchase","nonce","getNonce","requestPaymentMethod","data","paymentData","paymentMethodNonce","amount","getAmount","response","console","log","orderData","transaction_id","transaction","id","catch","map","p","price"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { loadCart, cartEmpty } from \"./helper/cartHelper\";\nimport { Link } from \"react-router-dom\";\nimport { getmeToken, processPayment } from \"./helper/paymentbhelper\";\nimport { createOrder } from \"./helper/orderHelper\";\nimport { isAutheticated } from \"../auth/helper\";\n\nimport DropIn from \"braintree-web-drop-in-react\";\n\nconst Paymentb = ({ products, setReload = f => f, reload = undefined }) => {\n  const [info, setInfo] = useState({\n    loading: false,\n    success: false,\n    clientToken: null,\n    error: \"\",\n    instance: {}\n  });\n\n  const userId = isAutheticated() && isAutheticated().user._id;\n  const token = isAutheticated() && isAutheticated().token;\n\n  const getToken = (userId, token) => {\n    getmeToken(userId, token).then(info => {\n      // console.log(\"INFORMATION\", info);\n      if (info?.error) {\n        setInfo({ ...info, error: info.error });\n      } else {\n        const clientToken = info?.clientToken;\n        setInfo({ clientToken });\n      }\n    });\n  };\n\n  const showbtdropIn = () => {\n    return (\n      <div>\n        {info.clientToken !== null && products.length > 0 ? (\n          <div>\n            <DropIn\n              options={{ authorization: info.clientToken }}\n              onInstance={instance => (info.instance = instance)}\n            />\n            <button className=\"btn btn-block btn-success\" onClick={onPurchase}>\n              Buy\n            </button>\n          </div>\n        ) : (\n          <h3>Please login or add something to cart</h3>\n        )}\n      </div>\n    );\n  };\n\n  useEffect(() => {\n    getToken(userId, token);\n  }, []);\n\n  const onPurchase = () => {\n    setInfo({ loading: true });\n    let nonce;\n    let getNonce = info?.instance?.requestPaymentMethod().then(data => {\n      nonce = data.nonce;\n      const paymentData = {\n        paymentMethodNonce: nonce,\n        amount: getAmount()\n      };\n      processPayment(userId, token, paymentData)\n        .then(response => {\n          setInfo({ ...info, success: response.success, loading: false });\n          console.log(\"PAYMENT SUCCESS\");\n          const orderData = {\n            products: products,\n            transaction_id: response.transaction.id,\n            amount: response.transaction.amount\n          };\n          createOrder(userId, token, orderData);\n          cartEmpty(() => {\n            console.log(\"Did we got a crash?\");\n          });\n\n          setReload(!reload);\n        })\n        .catch(error => {\n          setInfo({ loading: false, success: false });\n          console.log(\"PAYMENT FAILED\");\n        });\n    });\n  };\n\n  const getAmount = () => {\n    let amount = 0;\n    products.map(p => {\n      amount = amount + p.price;\n    });\n    return amount;\n  };\n\n  return (\n    <div>\n      <h3>Your bill is {getAmount()} $</h3>\n      {showbtdropIn()}\n    </div>\n  );\n};\n\nexport default Paymentb;\n"]},"metadata":{},"sourceType":"module"}